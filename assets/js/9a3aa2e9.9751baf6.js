"use strict";(self.webpackChunkxilio=self.webpackChunkxilio||[]).push([[718],{3774:(e,n,l)=>{l.d(n,{R:()=>i,x:()=>o});var t=l(6672);const a={},r=t.createContext(a);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},4430:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","description":"Netty\u6838\u5fc3\u7ec4\u4ef6\u4ecb\u7ecd","source":"@site/docs/java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u57fa\u7840\u77e5\u8bc6.md","sourceDirName":"java/\u7f51\u7edc\u7f16\u7a0b/Netty","slug":"/java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u57fa\u7840\u77e5\u8bc6","permalink":"/xilio-doc/docs/java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u57fa\u7840\u77e5\u8bc6","draft":false,"unlisted":false,"editUrl":"https://github.com/xilio1/xilio-doc/tree/main/docs/java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u57fa\u7840\u77e5\u8bc6.md","tags":[],"version":"current","frontMatter":{},"sidebar":"javaSidebar","previous":{"title":"\u5165\u95e8\u6848\u4f8b","permalink":"/xilio-doc/docs/java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u5165\u95e8\u6848\u4f8b"},"next":{"title":"\u5e38\u89c1\u7684\u5751","permalink":"/xilio-doc/docs/java/\u7f51\u7edc\u7f16\u7a0b/Netty/\u5e38\u89c1\u7684\u5751"}}');var a=l(3420),r=l(3774);const i={},o=void 0,d={},c=[{value:"Netty\u6838\u5fc3\u7ec4\u4ef6\u4ecb\u7ecd",id:"netty\u6838\u5fc3\u7ec4\u4ef6\u4ecb\u7ecd",level:2},{value:"Channel",id:"channel",level:2},{value:"\u7ebf\u7a0b\u6a21\u578b",id:"\u7ebf\u7a0b\u6a21\u578b",level:2},{value:"\u5355\u7ebf\u7a0b <code>QPS&lt;=5k</code>",id:"\u5355\u7ebf\u7a0b-qps5k",level:3},{value:"\u591a\u7ebf\u7a0b <code>1w&lt;=QPS&lt;=3w</code>",id:"\u591a\u7ebf\u7a0b-1wqps3w",level:3},{value:"\u4e3b\u4ece\u591a\u7ebf\u7a0b <code>QPS&gt;5w</code>",id:"\u4e3b\u4ece\u591a\u7ebf\u7a0b-qps5w",level:3},{value:"AttributeKey",id:"attributekey",level:2},{value:"ChannelHandler",id:"channelhandler",level:2},{value:"ChannelHandlerContext",id:"channelhandlercontext",level:3},{value:"\u751f\u547d\u5468\u671f",id:"\u751f\u547d\u5468\u671f",level:3},{value:"ByteBuf",id:"bytebuf",level:2},{value:"PooledByteBufAllocator",id:"pooledbytebufallocator",level:3},{value:"ChannelPipeline",id:"channelpipeline",level:2},{value:"IdleStateHandler \u5fc3\u8df3\u5904\u7406\u5668",id:"idlestatehandler-\u5fc3\u8df3\u5904\u7406\u5668",level:2},{value:"@Sharable\u6ce8\u89e3",id:"sharable\u6ce8\u89e3",level:2}];function s(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"netty\u6838\u5fc3\u7ec4\u4ef6\u4ecb\u7ecd",children:"Netty\u6838\u5fc3\u7ec4\u4ef6\u4ecb\u7ecd"}),"\n",(0,a.jsx)(n.h2,{id:"channel",children:"Channel"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u4e2a\u8fde\u63a5\u5206\u914d\u4e00\u4e2achannel\uff0c\u5982\uff1a"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u7ec8\u7aef A \u8fde\u63a5 \u2192 \u521b\u5efa Channel-1"}),"\n",(0,a.jsx)(n.li,{children:"\u7ec8\u7aef B \u8fde\u63a5 \u2192 \u521b\u5efa Channel-2"}),"\n",(0,a.jsx)(n.li,{children:"\u7ec8\u7aef C \u8fde\u63a5 \u2192 \u521b\u5efa Channel-3"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u7ebf\u7a0b\u6a21\u578b",children:"\u7ebf\u7a0b\u6a21\u578b"}),"\n",(0,a.jsxs)(n.h3,{id:"\u5355\u7ebf\u7a0b-qps5k",children:["\u5355\u7ebf\u7a0b ",(0,a.jsx)(n.code,{children:"QPS<=5k"})]}),"\n",(0,a.jsx)(n.p,{children:"\u6240\u6709I/O\u64cd\u4f5c\u548c\u4e1a\u52a1\u903b\u8f91\u7531\u5355\u4e2a\u7ebf\u7a0b\u5904\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"EventLoopGroup singleGroup = new NioEventLoopGroup(1); // \u5173\u952e\uff1a\u7ebf\u7a0b\u6570=1\nServerBootstrap b = new ServerBootstrap();\nb.group(singleGroup)  // \u5355\u7ebf\u7a0b\u540c\u65f6\u5904\u7406\u8fde\u63a5\u548cI/O\n .channel(NioServerSocketChannel.class)\n .childHandler(new ChannelInitializer<SocketChannel>() {\n     @Override\n     protected void initChannel(SocketChannel ch) {\n         ch.pipeline().addLast(new SimpleHandler());\n     }\n });\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"\u591a\u7ebf\u7a0b-1wqps3w",children:["\u591a\u7ebf\u7a0b ",(0,a.jsx)(n.code,{children:"1w<=QPS<=3w"})]}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u7ec4\u7ebf\u7a0b\u5171\u540c\u5904\u7406\u6240\u6709Channel\u7684I/O\u4e8b\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"EventLoopGroup workerGroup = new NioEventLoopGroup(16); // \u5173\u952e\uff1a\u591a\u7ebf\u7a0b\n\nServerBootstrap b = new ServerBootstrap();\nb.group(workerGroup)  // \u6240\u6709\u7ebf\u7a0b\u5e73\u7b49\u5904\u7406\u8fde\u63a5\u548cI/O\n .channel(NioServerSocketChannel.class)\n .childHandler(new ChannelInitializer<SocketChannel>() {\n     @Override\n     protected void initChannel(SocketChannel ch) {\n         ch.pipeline().addLast(new SimpleHandler());\n     }\n });\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"\u4e3b\u4ece\u591a\u7ebf\u7a0b-qps5w",children:["\u4e3b\u4ece\u591a\u7ebf\u7a0b ",(0,a.jsx)(n.code,{children:"QPS>5w"})]}),"\n",(0,a.jsx)(n.p,{children:"\u5206\u79bb\u8fde\u63a5\u63a5\u6536\uff08\u4e3b\u7ebf\u7a0b\u7ec4\uff09\u548cI/O\u5904\u7406\uff08\u5de5\u4f5c\u7ebf\u7a0b\u7ec4\uff09"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"EventLoopGroup bossGroup = new NioEventLoopGroup(2);  // \u4e3b\u7ebf\u7a0b\u7ec4\uff1a\u4e13\u8d23\u63a5\u6536\u8fde\u63a5\nEventLoopGroup workerGroup = new NioEventLoopGroup(16); // \u5de5\u4f5c\u7ebf\u7a0b\u7ec4\uff1a\u5904\u7406I/O\n\nServerBootstrap b = new ServerBootstrap();\nb.group(bossGroup, workerGroup)  // \u5173\u952e\uff1a\u53cc\u7ebf\u7a0b\u7ec4\n .channel(NioServerSocketChannel.class)\n .childHandler(new ChannelInitializer<SocketChannel>() {\n     @Override\n     protected void initChannel(SocketChannel ch) {\n         ch.pipeline().addLast(new ComplexHandler()); // \u590d\u6742\u4e1a\u52a1\u5904\u7406\n     }\n });\n"})}),"\n",(0,a.jsx)(n.h2,{id:"attributekey",children:"AttributeKey"}),"\n",(0,a.jsx)(n.h2,{id:"channelhandler",children:"ChannelHandler"}),"\n",(0,a.jsx)(n.h3,{id:"channelhandlercontext",children:"ChannelHandlerContext"}),"\n",(0,a.jsx)(n.h3,{id:"\u751f\u547d\u5468\u671f",children:"\u751f\u547d\u5468\u671f"}),"\n",(0,a.jsx)(n.h2,{id:"bytebuf",children:"ByteBuf"}),"\n",(0,a.jsx)(n.h3,{id:"pooledbytebufallocator",children:"PooledByteBufAllocator"}),"\n",(0,a.jsx)(n.h2,{id:"channelpipeline",children:"ChannelPipeline"}),"\n",(0,a.jsx)(n.p,{children:"\u6ce8\u610f\uff1a"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"addLast\u6dfb\u52a0\u7684\u5904\u7406\u5668\u9700\u8981\u8003\u8651\u987a\u5e8f\u95ee\u9898\uff0c\u4e0d\u80fd\u591f\u968f\u610f\u98a0\u5012\uff0c\u4e00\u822c\u662f\u5165\u7ad9Decode->\u51fa\u7ad9Encode\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"idlestatehandler-\u5fc3\u8df3\u5904\u7406\u5668",children:"IdleStateHandler \u5fc3\u8df3\u5904\u7406\u5668"}),"\n",(0,a.jsx)(n.p,{children:"\u8be5\u5904\u7406\u5668\u7684\u51e0\u79cd\u7a7a\u95f2\u72b6\u6001"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public enum IdleState {\nREADER_IDLE, //\u8bfb\u7a7a\u95f2\u72b6\u6001\nWRITER_IDLE, //\u5199\u7a7a\u95f2\u72b6\u6001\nALL_IDLE; //\u8bfb\u5199\u90fd\u662f\u7a7a\u60f3\u72b6\u6001\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u6848\u4f8b\uff1a\u5fc3\u8df3\u5904\u7406\u5668",(0,a.jsx)(n.code,{children:"new IdleStateHandler(10, 0, 0, TimeUnit.SECONDS)"}),"10\u79d2\u5185\u6ca1\u6709\u6536\u5230\u5ba2\u6237\u7aef\u4efb\u4f55\u6570\u636e\uff0c\u5219\u5173\u95ed\u8fde\u63a5\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'ChannelHandler#userEventTriggered\n @Override\npublic void userEventTriggered(ChannelHandlerContext ctx, Object evt) {\n    if (evt instanceof IdleStateEvent) {\n        IdleStateEvent event = (IdleStateEvent) evt;\n        //\u5982\u679c\u662f\u8bfb\u7a7a\u95f2\u72b6\u6001\n        if (event.state() == IdleState.READER_IDLE) {\n            System.out.println("Client timeout, closing connection");\n            ctx.close(); //\u4f1a\u65ad\u5f00\u4e0e\u5ba2\u6237\u7aef\u7684\u94fe\u63a5\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"sharable\u6ce8\u89e3",children:"@Sharable\u6ce8\u89e3"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(s,{...e})}):s(e)}}}]);